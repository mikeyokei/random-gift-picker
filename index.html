<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Gift Picker</title>
    <style>
        /* Your existing CSS here */
    </style>
</head>
<body>
    <div class="container">
        <h1>Random Gift Picker</h1>
        <input type="text" id="nameInput" placeholder="Enter your name" required>
        <div id="giftDisplay">Enter your name and click the button to pick a random gift!</div>
        <button id="pickButton">Pick a Gift</button>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1QTxxpjHrDzCsQj23rFxA7rQXcgwqgiU",
            authDomain: "gift-randomizer.firebaseapp.com",
            projectId: "gift-randomizer",
            storageBucket: "gift-randomizer.appspot.com",
            messagingSenderId: "1056233098101",
            appId: "1:1056233098101:web:b2b228a1593d6c2aebe13c",
            measurementId: "G-HPQ9C898SW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        const gifts = [
            "Túi Labubu Blind Box",
            "Kẹp giấy Labubu Blind Box",
            "Đồ kẹp polaroid Candy Bear",
            "Miffy 10cm",
            "Miffy Móc chìa khóa",
            "CryBaby Flower Blind Box",
            "Mền tiên cá ariel disney",
            "Poster Brat (fan-made)",
            "Sổ VanGogh Museum",
            "Sổ claude monet",
            "2 tách trà gốm"
        ];

        function pickRandomGift() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('Please enter your name first!');
                return;
            }

            if (localStorage.getItem('giftPicked')) {
                alert('You have already picked a gift!');
                return;
            }

            get(ref(database, 'pickedGifts')).then((snapshot) => {
                let pickedGifts = snapshot.val() || {};
                let availableGifts = gifts.filter(gift => !Object.values(pickedGifts).includes(gift));

                if (availableGifts.length === 0) {
                    alert('Sorry, all gifts have been picked!');
                    return;
                }

                const randomIndex = Math.floor(Math.random() * availableGifts.length);
                const selectedGift = availableGifts[randomIndex];
                const result = `${name} receives ${selectedGift}`;

                push(ref(database, 'pickedGifts'), selectedGift);

                document.getElementById('giftDisplay').textContent = result;
                localStorage.setItem('giftPicked', 'true');
                localStorage.setItem('selectedGift', result);
                document.getElementById('pickButton').disabled = true;
                document.getElementById('nameInput').disabled = true;
            });
        }

        window.onload = function() {
            if (localStorage.getItem('giftPicked')) {
                const savedResult = localStorage.getItem('selectedGift');
                document.getElementById('giftDisplay').textContent = savedResult;
                document.getElementById('pickButton').disabled = true;
                document.getElementById('nameInput').disabled = true;
            }
        }

        document.getElementById('pickButton').addEventListener('click', pickRandomGift);
    </script>
</body>
</html>
